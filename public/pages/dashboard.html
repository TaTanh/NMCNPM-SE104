<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dashboard – Quản lý học sinh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/layout/styles.css">
    <script src="/js/toast.js"></script>
    <script src="/js/auth.js"></script>
</head>

<body class="dashboard-body">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <img src="/assets/uit_logo.png" alt="UIT Logo">
            <span>QL Học Sinh</span>
        </div>

        <nav class="sidebar-menu">
            <a href="/pages/dashboard.html" class="active">Dashboard</a>
            <a href="/pages/students.html">Quản lý học sinh</a>
            <a href="/pages/classes.html">Quản lý lớp học</a>
            <a href="/pages/subject_list.html">Quản lý môn học</a>
            <a href="/pages/grade_entry_select.html">Nhập điểm</a>
            <a href="/pages/grade_select.html">Bảng điểm</a>
            <a href="/pages/reports.html">Báo cáo tổng kết</a>
            <a href="/pages/users.html" id="menuUsers" style="display:none;">Quản lý người dùng</a>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="main">

        <!-- HEADER -->
        <header class="topbar">
            <div></div>
            <div class="user-info">
                <span id="userGreeting">Xin chào, Admin</span>
                <img src="/assets/user.png" class="avatar" alt="user">
                <button class="btn btn-outline btn-sm" onclick="logout()" style="margin-left:10px;">Đăng xuất</button>
            </div>
        </header>

        <!-- CONTENT -->
        <div class="content">

            <!-- STAT CARDS -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Học sinh</h3>
                    <p id="statStudents">--</p>
                </div>

                <div class="stat-card">
                    <h3>Giáo viên</h3>
                    <p id="statTeachers">--</p>
                </div>

                <div class="stat-card">
                    <h3>Lớp học</h3>
                    <p id="statClasses">--</p>
                </div>

                <div class="stat-card">
                    <h3>Môn học</h3>
                    <p id="statSubjects">--</p>
                </div>
            </div>
                        <!-- BÁO CÁO TỔNG KẾT (BM7) -->
            <h2 class="page-title" style="margin-top: 24px; margin-bottom: 12px;">
                Báo cáo tổng kết
            </h2>

            <!-- Filters: năm học, học kì, lớp -->
            <div class="filters-row">
                <div class="filter-item">
                    <label class="filter-label" for="reportYear">Năm học</label>
                    <select id="reportYear">
                        <option>2024–2025</option>
                        <option>2023–2024</option>
                    </select>
                </div>

                <div class="filter-item">
                    <label class="filter-label" for="reportSemester">Học kì</label>
                    <select id="reportSemester">
                        <option>Cả năm</option>
                        <option>Học kì 1</option>
                        <option>Học kì 2</option>
                    </select>
                </div>

                <div class="filter-item">
                    <label class="filter-label" for="reportClass">Lớp</label>
                    <select id="reportClass">
                        <option>Tất cả lớp</option>
                        <option>10A1</option>
                        <option>10A2</option>
                    </select>
                </div>
            </div>

            <!-- Bảng tổng kết theo môn -->
            <div class="table-wrapper" style="margin-top: 10px; margin-bottom: 16px;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Môn học</th>
                            <th>Số HS đạt</th>
                            <th>Số HS chưa đạt</th>
                            <th>Tỉ lệ đạt (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Toán</td>
                            <td>120</td>
                            <td>15</td>
                            <td>88.9</td>
                        </tr>
                        <tr>
                            <td>Văn</td>
                            <td>118</td>
                            <td>17</td>
                            <td>87.4</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Bảng tổng kết theo học sinh -->
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Mã HS</th>
                            <th>Họ tên</th>
                            <th>Lớp</th>
                            <th>Điểm TB năm</th>
                            <th>Xếp loại</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>HS001</td>
                            <td>Nguyễn Văn A</td>
                            <td>10A1</td>
                            <td>8.3</td>
                            <td>Giỏi</td>
                        </tr>
                        <tr>
                            <td>HS002</td>
                            <td>Trần Thị B</td>
                            <td>10A1</td>
                            <td>7.2</td>
                            <td>Khá</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- BIỂU ĐỒ PLACEHOLDER -->
            <div class="chart-card">
                <div class="chart-placeholder">Biểu đồ thống kê (placeholder)</div>
            </div>

        </div>

    </div>

    <script>
        // ========== LOAD THỐNG KÊ DASHBOARD ==========
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/dashboard/stats');
                const stats = await response.json();
                
                document.getElementById('statStudents').textContent = stats.students || 0;
                document.getElementById('statTeachers').textContent = stats.teachers || 0;
                document.getElementById('statClasses').textContent = stats.classes || 0;
                document.getElementById('statSubjects').textContent = stats.subjects || 0;
            } catch (error) {
                console.error('Lỗi load thống kê:', error);
            }
        }

        // Khởi tạo khi trang load
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboardStats();
            updateUIByPermission();
        });
    </script>

</body>
</html>
