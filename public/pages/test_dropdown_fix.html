<!DOCTYPE html>
<html>
<head>
    <title>Test Fix Dropdown</title>
    <script src="/js/toast.js"></script>
    <script src="/js/auth.js"></script>
</head>
<body>
    <h1>Test Fix Dropdown - M·ª•c Nh·∫≠p H·∫°nh Ki·ªÉm</h1>
    
    <div id="results"></div>
    
    <script>
        async function runTests() {
            const results = document.getElementById('results');
            let html = '<h2>K·∫øt Qu·∫£ Test</h2><ul>';
            
            try {
                // Test 1: Load nƒÉm h·ªçc
                const yearsRes = await fetch('/api/settings/school-years');
                const years = await yearsRes.json();
                html += `<li>‚úÖ Load nƒÉm h·ªçc: ${years.length} nƒÉm h·ªçc</li>`;
                
                // Test 2: Load l·ªõp
                const classesRes = await fetch('/api/classes');
                const classes = await classesRes.json();
                html += `<li>‚úÖ Load l·ªõp: ${classes.length} l·ªõp</li>`;
                
                // Test 3: Ph√¢n t√≠ch kh·ªëi
                const grades = new Set();
                classes.forEach(c => grades.add(c.makhoilop));
                html += `<li>‚úÖ Ph√¢n t√≠ch kh·ªëi: ${grades.size} kh·ªëi (${Array.from(grades).sort().join(', ')})</li>`;
                
                // Test 4: Ph√¢n t√≠ch l·ªõp theo nƒÉm h·ªçc
                if (years.length > 0) {
                    const firstYear = years[0].manamhoc;
                    const classesForYear = classes.filter(c => c.manamhoc == firstYear);
                    html += `<li>‚úÖ L·ªõp cho nƒÉm h·ªçc ${years[0].tennamhoc}: ${classesForYear.length} l·ªõp</li>`;
                    
                    // Test 5: Ph√¢n t√≠ch kh·ªëi cho nƒÉm h·ªçc ƒë·∫ßu ti√™n
                    const gradesForYear = new Set();
                    classesForYear.forEach(c => gradesForYear.add(c.makhoilop));
                    html += `<li>‚úÖ Kh·ªëi cho nƒÉm h·ªçc ${years[0].tennamhoc}: ${gradesForYear.size} kh·ªëi</li>`;
                }
                
                html += '<li><strong>üéâ T·∫•t c·∫£ test ƒë·ªÅu pass! Dropdown s·∫Ω ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng</strong></li>';
                
            } catch (error) {
                html += `<li>‚ùå L·ªói: ${error.message}</li>`;
            }
            
            html += '</ul>';
            results.innerHTML = html;
        }
        
        window.addEventListener('load', runTests);
    </script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #555;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            padding: 10px;
            margin: 5px 0;
            background: #f0f0f0;
            border-radius: 4px;
        }
    </style>
</body>
</html>
